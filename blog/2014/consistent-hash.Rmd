---
author: "patrick.unicorn"
output:
  html_document:
    css: ../css/main.css
    highlight: null
    theme: null
---

**声明：** 所写均为个人阅读所思所想，请批判阅读。

* * *

## Theory

一致性哈希(Consistent Hashing)算法是分布式领域非常重要的算法，它的原理比较简单。其基本思想就是使用相同的hash 算法，将对象和 cache 都映射到同一个 hash 数值空间中。主要目的是当增减cache节点时，避免大规模影响cache访问有效性，提高系统维护性。

<!--more-->

## Progress

#### 普通哈希

![普通哈希](../images/content/consistent-hash-01.png)

#### 一致性哈希

![一致性哈希](../images/content/consistent-hash-02.png)

## Problems

#### Cach's HashCode

cache 的 hash 计算，一般的方法可以使用 cache 机器的 IP 地址或者机器名作为hash 输入。必须保证cache尽量均匀的分布在hash值区间内。一般的缓存机器组的IP或者机器名都是很相近的，那么是否能够保证其对应的hashcode是可以均匀分布在hash值区间内呢？最糟糕的情况，如果两个cache的hash值是相邻的，那么，必然是不合理的。因此，在实际过程中必须检测这种情况并处理,比如后文提到的**虚拟节点**。

#### Virtual Node

> hash 算法并不是保证绝对的平衡，如果 cache 较少的话，对象并不能被均匀的映射到 cache 上，比如在上面的例子中，仅部署 cache A 和 cache C 的情况下，在 4 个对象中， cache A 仅存储了 object1 ，而 cache C 则存储了 object2 、 object3 和 object4 ；分布是很不均衡的。
>
> 为了解决这种情况， consistent hashing 引入了“虚拟节点”的概念，它可以如下定义：
>
> “虚拟节点”（ virtual node ）是实际节点在 hash 空间的复制品(replication)，一实际个节点对应了若干个“虚拟节点”，这个对应个数也成为“复制个数”，“虚拟节点”在 hash 空间中以 hash 值排列。
> 摘自[reference2][2]

## Reference

+ [Consistent Hashing and Random Trees:Distributed Caching Protocols for Relieving Hot Spots on the World Wide Web][1]
+ [一致性 hash 算法][2]

[1]: http://www.akamai.com/dl/technical_publications/ConsistenHashingandRandomTreesDistributedCachingprotocolsforrelievingHotSpotsontheworldwideweb.pdf
[2]: http://blog.csdn.net/sparkliang/article/details/5279393
